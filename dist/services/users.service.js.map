{"version":3,"sources":["../../src/services/users.service.ts"],"sourcesContent":["import { hash } from 'bcrypt';\r\nimport DB from '@databases';\r\nimport { CreateUserDto } from '@dtos/users.dto';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { User } from '@interfaces/users.interface';\r\nimport { isEmpty } from '@utils/util';\r\n\r\nclass UserService {\r\n  public users = DB.Users;\r\n\r\n  public async findAllUser(): Promise<User[]> {\r\n    const allUser: User[] = await this.users.findAll();\r\n    return allUser;\r\n  }\r\n\r\n  public async findUserById(userId: number): Promise<User> {\r\n    if (isEmpty(userId)) throw new HttpException(400, 'UserId is empty');\r\n\r\n    const findUser: User = await this.users.findByPk(userId);\r\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    return findUser;\r\n  }\r\n\r\n  public async createUser(userData: CreateUserDto): Promise<User> {\r\n    if (isEmpty(userData)) throw new HttpException(400, 'userData is empty');\r\n\r\n    const findUser: User = await this.users.findOne({ where: { email: userData.email } });\r\n    if (findUser) throw new HttpException(409, `This email ${userData.email} already exists`);\r\n\r\n    const hashedPassword = await hash(userData.password, 10);\r\n    const createUserData: User = await this.users.create({ ...userData, password: hashedPassword });\r\n    return createUserData;\r\n  }\r\n\r\n  public async updateUser(userId: number, userData: CreateUserDto): Promise<User> {\r\n    if (isEmpty(userData)) throw new HttpException(400, 'userData is empty');\r\n\r\n    const findUser: User = await this.users.findByPk(userId);\r\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    const hashedPassword = await hash(userData.password, 10);\r\n    await this.users.update({ ...userData, password: hashedPassword }, { where: { id: userId } });\r\n\r\n    const updateUser: User = await this.users.findByPk(userId);\r\n    return updateUser;\r\n  }\r\n\r\n  public async deleteUser(userId: number): Promise<User> {\r\n    if (isEmpty(userId)) throw new HttpException(400, \"User doesn't existId\");\r\n\r\n    const findUser: User = await this.users.findByPk(userId);\r\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\r\n\r\n    await this.users.destroy({ where: { id: userId } });\r\n\r\n    return findUser;\r\n  }\r\n}\r\n\r\nexport default UserService;\r\n"],"names":["UserService","findAllUser","allUser","users","findAll","findUserById","userId","isEmpty","HttpException","findUser","findByPk","createUser","userData","findOne","where","email","hashedPassword","hash","password","createUserData","create","updateUser","update","id","deleteUser","destroy","DB","Users"],"mappings":"AAAA;;;;+BA4DA;;aAAA;;wBA5DqB;kDACN;+BAEe;sBAEN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAExB,IAAA,AAAMA,cAAN,MAAMA;IAGJ,MAAaC,cAA+B;QAC1C,MAAMC,UAAkB,MAAM,IAAI,CAACC,KAAK,CAACC,OAAO;QAChD,OAAOF;IACT;IAEA,MAAaG,aAAaC,MAAc,EAAiB;QACvD,IAAIC,IAAAA,aAAO,EAACD,SAAS,MAAM,IAAIE,4BAAa,CAAC,KAAK,mBAAmB;QAErE,MAAMC,WAAiB,MAAM,IAAI,CAACN,KAAK,CAACO,QAAQ,CAACJ;QACjD,IAAI,CAACG,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,sBAAsB;QAElE,OAAOC;IACT;IAEA,MAAaE,WAAWC,QAAuB,EAAiB;QAC9D,IAAIL,IAAAA,aAAO,EAACK,WAAW,MAAM,IAAIJ,4BAAa,CAAC,KAAK,qBAAqB;QAEzE,MAAMC,WAAiB,MAAM,IAAI,CAACN,KAAK,CAACU,OAAO,CAAC;YAAEC,OAAO;gBAAEC,OAAOH,SAASG,KAAK;YAAC;QAAE;QACnF,IAAIN,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,CAAC,WAAW,EAAEI,SAASG,KAAK,CAAC,eAAe,CAAC,EAAE;QAE1F,MAAMC,iBAAiB,MAAMC,IAAAA,YAAI,EAACL,SAASM,QAAQ,EAAE;QACrD,MAAMC,iBAAuB,MAAM,IAAI,CAAChB,KAAK,CAACiB,MAAM,CAAC,qCAAKR;YAAUM,UAAUF;;QAC9E,OAAOG;IACT;IAEA,MAAaE,WAAWf,MAAc,EAAEM,QAAuB,EAAiB;QAC9E,IAAIL,IAAAA,aAAO,EAACK,WAAW,MAAM,IAAIJ,4BAAa,CAAC,KAAK,qBAAqB;QAEzE,MAAMC,WAAiB,MAAM,IAAI,CAACN,KAAK,CAACO,QAAQ,CAACJ;QACjD,IAAI,CAACG,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,sBAAsB;QAElE,MAAMQ,iBAAiB,MAAMC,IAAAA,YAAI,EAACL,SAASM,QAAQ,EAAE;QACrD,MAAM,IAAI,CAACf,KAAK,CAACmB,MAAM,CAAC,qCAAKV;YAAUM,UAAUF;YAAkB;YAAEF,OAAO;gBAAES,IAAIjB;YAAO;QAAE;QAE3F,MAAMe,aAAmB,MAAM,IAAI,CAAClB,KAAK,CAACO,QAAQ,CAACJ;QACnD,OAAOe;IACT;IAEA,MAAaG,WAAWlB,MAAc,EAAiB;QACrD,IAAIC,IAAAA,aAAO,EAACD,SAAS,MAAM,IAAIE,4BAAa,CAAC,KAAK,wBAAwB;QAE1E,MAAMC,WAAiB,MAAM,IAAI,CAACN,KAAK,CAACO,QAAQ,CAACJ;QACjD,IAAI,CAACG,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,sBAAsB;QAElE,MAAM,IAAI,CAACL,KAAK,CAACsB,OAAO,CAAC;YAAEX,OAAO;gBAAES,IAAIjB;YAAO;QAAE;QAEjD,OAAOG;IACT;;aAjDON,QAAQuB,kBAAE,CAACC,KAAK;;AAkDzB;MAEA,WAAe3B"}